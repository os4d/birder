{% extends "bootstrap/base.html" %}
{% block metas %}
    {{ super() }}
    <meta name="description" content=""/>
{% endblock metas %}
{% block title %}{{ config.SITE_TITLE }}{% endblock %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{config.URL_PREFIX}}/static/css/theme.css?v={{ version }}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{config.URL_PREFIX}}/static/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="{{config.URL_PREFIX}}/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="{{config.URL_PREFIX}}/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="{{config.URL_PREFIX}}/static/images/favicon/site.webmanifest">
    <link rel="mask-icon" href="{{config.URL_PREFIX}}/static/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="{{config.URL_PREFIX}}/static/images/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="{{config.URL_PREFIX}}/static/images/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
{% endblock %}

{% block navbar %}
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{config.URL_PREFIX}}/"><img class="logo"
                                                  src="{{config.URL_PREFIX}}/static/images/birder.png"> {{ config.SITE_TITLE }}</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    {% for g in config.GRANULARITIES %}
                        <li class="nav-item">
                            <a class="nav-link {% if page == g %}selected{% endif %}" href="{{config.URL_PREFIX}}/{{ g }}/">{{ g.title() }}</a>
                        </li>
                    {% endfor %}
                    <li class="nav-item">
                        <a class="nav-link {% if page == "about" %}selected{% endif %}" href="{{config.URL_PREFIX}}/about/">About</a>
                    </li>
                    <li class="nav-item"><span class="d-md-none nav-link">&nbsp;|&nbsp;</span></li>
                    <li class="nav-item">
                        {% if user %}
                            <a class="nav-link" id="logout" href="#">Logout</a>
                        {% elif basic_auth %}
                            <a class="nav-link" href="{{config.URL_PREFIX}}/login/">Login</a>
                        {% endif %}
                    </li>
                </ul>
            </div>
        </div>
    </nav>
{% endblock %}

{% block content %}
    {% block header %}{% endblock %}
    {% block page %}{% endblock %}
    {% block footer %}
        <footer class="py-5 bg-dark">
            <div class="container">
                <p class="m-0 text-center text-white"><img class="logo"
                                                           src="{{config.URL_PREFIX}}/static/images/birder.png">birder {{ version }}
                    &copy; 2019 OS4D ltd</p>
            </div>
            <!-- /.container -->
        </footer>
    {% endblock %}
    {% block privacy %}
        <span id="privacy" class="banner tracking-banner pt-2 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-9 text-left mb-2">
                This website uses cookies and other technology to customize advertising and provide you a more personalized experience.
                </div>
                <div class="col-md-3 mb-2">
                    <button id="btn-privacy" class="btn btn-sm btn-outline-dark btn-block">Accept</button>
                </div>
            </div>
        </div>
        </span>
    {% endblock %}
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

    <script>
        $('#btn-privacy').on('click', function () {
            Cookies.set('privacy', 1);
            $('#privacy').hide();
        });
        if (Cookies.get('privacy') === "1") {
            $('#privacy').hide();
        }
        $('#logout').click(function (e) {
            e.preventDefault();
            jQuery.ajax({
                type: "GET",
                url: "{{ config.URL_PREFIX }}/logout/",
                async: true,
                dataType: 'json',
                username: "{{ user }}" + Math.random(),
                password: Math.random(),
                headers: {"Authorization": "Basic xxx"},
            })
                .done(function () {
                    // If we don't get an error, we actually got an error as we expect an 401!
                })
                .fail(function () {
                    // We expect to get an 401 Unauthorized error! In this case we are successfully
                    // logged out and we redirect the user.
                    window.location = "{{ config.URL_PREFIX }}/";
                });

            return false;
        })
    </script>
{% endblock %}
